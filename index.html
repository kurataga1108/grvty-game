<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GRVTY - Prototype</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; color: white; font-family: sans-serif; }
        canvas { background: #000; border: 2px solid #555; }
        #ui { position: absolute; top: 10px; text-align: center; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">SWIPE TO CHANGE GRAVITY</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- 設定とデータ ---
const tileSize = size / 10; // 10x10のグリッド
const level = [
    [1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,1,1,0,1],
    [1,0,1,0,0,0,0,1,0,1],
    [1,0,1,0,1,1,0,1,0,1],
    [1,0,0,0,1,2,0,0,0,1], // 2がゴール
    [1,1,1,0,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1]
];

// --- 衝突判定関数 ---
function checkCollision() {
    // 座標から現在のタイル位置を計算
    let gridX = Math.floor(ball.x / tileSize);
    let gridY = Math.floor(ball.y / tileSize);

    const tile = level[gridY][gridX];

    if (tile === 1) { // 壁にめり込んだら押し戻す
        ball.x -= ball.vx;
        ball.y -= ball.vy;
        ball.vx = 0;
        ball.vy = 0;
    } else if (tile === 2) { // ゴール
        alert("GOAL! おめでとう！");
        resetGame();
    }
}

function resetGame() {
    ball.x = tileSize * 1.5;
    ball.y = tileSize * 1.5;
    ball.vx = 0; ball.vy = 0;
    gravity = {x:0, y:0.5};
}

// --- 描画関数 ---
function draw() {
    ctx.clearRect(0, 0, size, size);

    // タイルの描画
    for (let y = 0; y < level.length; y++) {
        for (let x = 0; x < level[y].length; x++) {
            if (level[y][x] === 1) {
                ctx.fillStyle = "#555"; // 壁
                ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
            } else if (level[y][x] === 2) {
                ctx.fillStyle = "#ff0"; // ゴール（黄）
                ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
            }
        }
    }

    // ボールの描画
    ctx.fillStyle = '#0f0';
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
    ctx.fill();
}

// update関数の中で checkCollision() を呼び出すように変更してください
function update() {
    ball.vx += gravity.x;
    ball.vy += gravity.y;
    ball.x += ball.vx;
    ball.y += ball.vy;

    checkCollision(); // 当たり判定

    draw();
    requestAnimationFrame(update);
}

    </script>
</body>
</html>
